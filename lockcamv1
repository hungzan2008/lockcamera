local Camera = game.Workspace.CurrentCamera
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local AimlockEnabled = false
local Target = nil
local CircleSize = 60 -- üéØ K√≠ch th∆∞·ªõc h√¨nh tr√≤n (c√≥ th·ªÉ ch·ªânh)
local CircleOpacity = 0.5 -- üé® ƒê·ªô trong su·ªët (0 = trong su·ªët, 1 = ƒë·∫≠m)
local CircleColor = Color3.fromRGB(128, 0, 128) -- üé® M√†u s·∫Øc h√¨nh tr√≤n (t√≠m)

-- üìå T·∫°o GUI
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
local AimButton = Instance.new("TextButton", ScreenGui)
local Circle = Instance.new("Frame", ScreenGui)
local DragFrame = Instance.new("Frame", ScreenGui)

-- üîò C√†i ƒë·∫∑t n√∫t ON/OFF
AimButton.Size = UDim2.new(0, 100, 0, 50)
AimButton.Position = UDim2.new(0.8, 0, 0.8, 0)
AimButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
AimButton.Text = "OFF"
AimButton.TextSize = 20
AimButton.TextColor3 = Color3.fromRGB(255, 255, 255)
AimButton.Font = Enum.Font.SourceSansBold
AimButton.BorderSizePixel = 2
AimButton.BorderColor3 = Color3.fromRGB(255, 255, 255)
AimButton.Draggable = true -- K√©o n√∫t ƒëi b·∫•t k·ª≥ ƒë√¢u

-- üìå T·∫°o v√πng k√©o GUI
DragFrame.Size = UDim2.new(0, 100, 0, 50)
DragFrame.Position = AimButton.Position
DragFrame.BackgroundTransparency = 1
DragFrame.Draggable = true -- Cho ph√©p k√©o
DragFrame.Parent = ScreenGui

-- üéØ C√†i ƒë·∫∑t h√¨nh tr√≤n
Circle.Size = UDim2.new(0, CircleSize, 0, CircleSize)
Circle.Position = UDim2.new(0.5, -CircleSize/2, 0.5, -CircleSize/2)
Circle.BackgroundColor3 = CircleColor
Circle.BackgroundTransparency = CircleOpacity
Circle.BorderSizePixel = 2
Circle.BorderColor3 = Color3.fromRGB(255, 255, 255)
Circle.Visible = false

-- üîç T√¨m ng∆∞·ªùi ch∆°i g·∫ßn nh·∫•t
function GetClosestPlayer()
    local MaxDistance = math.huge
    local ClosestPlayer = nil

    for _, Player in pairs(Players:GetPlayers()) do
        if Player ~= LocalPlayer and Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") then
            local Character = Player.Character
            local Head = Character:FindFirstChild("Head")

            if Head then
                local ScreenPoint = Camera:WorldToViewportPoint(Head.Position)
                local Distance = (Vector2.new(ScreenPoint.X, ScreenPoint.Y) - Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)).magnitude

                if Distance < MaxDistance then
                    MaxDistance = Distance
                    ClosestPlayer = Character
                end
            end
        end
    end
    return ClosestPlayer
end

-- üîò B·∫≠t/t·∫Øt Aimlock b·∫±ng n√∫t
AimButton.MouseButton1Click:Connect(function()
    AimlockEnabled = not AimlockEnabled

    if AimlockEnabled then
        Target = GetClosestPlayer()
        Circle.Visible = true
        AimButton.Text = "ON"
        AimButton.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
    else
        Target = nil
        Circle.Visible = false
        AimButton.Text = "OFF"
        AimButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    end
end)

-- üéØ Aimlock khi h√¨nh tr√≤n g·∫ßn ƒë·∫ßu ƒë·ªëi th·ªß
RunService.RenderStepped:Connect(function()
    if AimlockEnabled then
        local Closest = GetClosestPlayer()

        if Closest and Closest:FindFirstChild("Head") then
            local HeadPos = Camera:WorldToViewportPoint(Closest.Head.Position)
            local DistanceToCircle = (Vector2.new(HeadPos.X, HeadPos.Y) - Vector2.new(Circle.Position.X, Circle.Position.Y)).magnitude

            -- N·∫øu h√¨nh tr√≤n g·∫ßn ƒë·∫ßu ƒë·ªëi th·ªß, t·ª± ƒë·ªông lock
            if DistanceToCircle < CircleSize / 2 then
                Target = Closest
                Camera.CFrame = CFrame.new(Camera.CFrame.Position, Target.Head.Position)
            end
        end
    end
end)

-- üìå K√©o h√¨nh tr√≤n ra kh·ªèi ƒë·ªëi th·ªß khi di chuy·ªÉn camera
UserInputService.InputChanged:Connect(function(input)
    if AimlockEnabled and Target and input.UserInputType == Enum.UserInputType.MouseMovement then
        Target = nil -- H·ªßy Aimlock khi camera di chuy·ªÉn ra ch·ªó kh√°c
    end
end)

-- üìå K√©o GUI ƒë·∫øn v·ªã tr√≠ kh√°c
local dragging, dragInput, dragStart, startPos

DragFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = DragFrame.Position

        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

DragFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

RunService.RenderStepped:Connect(function()
    if dragging and dragInput then
        local delta = dragInput.Position - dragStart
        DragFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        AimButton.Position = DragFrame.Position -- Di chuy·ªÉn n√∫t theo
    end
end)
